<html>
<head>
<style>
table {
  width:100%;
}
table, th, td {
  border: 1px solid black;
  border-collapse: collapse;
}
th, td {
  padding: 15px;
  text-align: left;
}
#t01 tr:nth-child(even) {
  background-color: #eee;
}
#t01 tr:nth-child(odd) {
 background-color: #fff;
}
#t01 th {
  background-color: black;
  color: white;
}
</style>
</head>

<body>
<h1 style="text-align:center">Threat Attribution Result</h1>


<?php
$target_dir = "/var/www/html/uploads/";
$target_file = $target_dir . basename($_FILES["fileToUpload"]["name"]);
$uploadOk = 1;
$imageFileType = strtolower(pathinfo($target_file,PATHINFO_EXTENSION));
// Calculate SHA256 hash
if(isset($_POST["submit"])) {
 $sha256file = hash_file( 'sha256', $_FILES["fileToUpload"]["tmp_name"] );//true
 $md5file = sha1_file($_FILES["fileToUpload"]["tmp_name"]);
 //echo $sha256file;
 $uploadOk = 1;
}


$servername = "localhost";
$username = "s20";
$password = "malware";

// Create connection
$conn = new mysqli($servername, $username, $password);

// Check connection
if ($conn->connect_error) {
  die("Connection failed: " . $conn->connect_error);
}
//echo "Connected successfully";

$sql = "SELECT SHA256_HASH, BYTECODE_VIEW_PREDICTION,  OPCODE_VIEW_PREDICTION, HEADER_VIEW_PREDICTION, MULTI_CLASS_PREDICTION, multi_class_apt_profile  FROM mysql.CTA_ATTRIBUTION_T T WHERE T.SHA256_HASH= '$sha256file' ";
$result = $conn->query($sql);
//$numrows = mysql_num_rows($result);
//echo mysql_num_rows($result);
//var_dump($result);
if ($result->num_rows > 0) {

echo '<table id="t01">
  <tr>
    <th>SHA256 HASH</th>
    <th>BYTECODE VIEW PREDICTION</th> 
    <th>OPCODE VIEW PREDICTION</th>
    <th>HEADER VIEW PREDICTION</th>
    <th>MULTI VIEW PREDICTION</th>
    <th>THREAT PROFILE</th>
  </tr>';
  // output data of each row
  while($row = $result->fetch_assoc()) {
    echo "<tr><td>" . $row["SHA256_HASH"]. "</td><td>" . $row["BYTECODE_VIEW_PREDICTION"]. "</td><td>" . $row["OPCODE_VIEW_PREDICTION"]. "</td><td>" .$row["HEADER_VIEW_PREDICTION"]. "</td><td>" . $row["MULTI_CLASS_PREDICTION"]. "</td><td>" .$row["multi_class_apt_profile"]. "</td></tr>";
  }
} else {
  echo "The uploaded file needs to analysed further. The result will be sent to your email id.";
}
$conn->close();
?>
</table>
</body>
</html>
